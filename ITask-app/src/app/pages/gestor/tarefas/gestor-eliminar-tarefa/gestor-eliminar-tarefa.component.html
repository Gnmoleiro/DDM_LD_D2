@if (loading$ | async){
<app-loading></app-loading>
}
@else{
  <h2 class="mb-4 text-center">Eliminar tarefa</h2>
    <ion-grid>
        <ion-row class="ion-align-items-center">
            <ion-col size="12" size-md="6">
            <ion-item>
                <ion-input
                placeholder="Pesquisar por título..."
                [(ngModel)]="searchTerm">
                </ion-input>
            </ion-item>
            </ion-col>
            <ion-col size="6" size-md="3">
            <ion-item>
                <ion-select label="Tipo de tarefa" placeholder="Tipo de tarefa" [(ngModel)]="filtroTipoTarefa">
                <ion-select-option value="">Todos</ion-select-option>
                @for (item of tipoTarefas; track $index) {
                    <ion-select-option
                                        [value]="item.idTipoTarefa">
                        {{item.nome}}
                    </ion-select-option>
                }
                </ion-select>
            </ion-item>
            </ion-col>
            <ion-col size="6" size-md="3">
            <ion-item>
                <ion-select label="Programador" placeholder="Programador" [(ngModel)]="filtroProgramador">
                <ion-select-option value="">Todos</ion-select-option>
                    @for (p of programadores; track p.idUser) {
                        <ion-select-option [value]="p.idUser">
                            {{p.nome}}
                        </ion-select-option>
                    }
                </ion-select>
            </ion-item>
            </ion-col>

        </ion-row>
        <ion-row class="ion-align-items-center">
            <ion-col size="6" size-md="3">
            <ion-item>
                <ion-select label="Estado da tarefa" placeholder="Estado" [(ngModel)]="filtroEstadoTarefa">
                    <ion-select-option value="">Todos</ion-select-option>
                    @for (item of estadoTarefas; track item.estadoTarefa) {
                        <ion-select-option [value]="item.estadoTarefa">
                            {{item.estadoTarefa}}
                        </ion-select-option>
                    }
                </ion-select>
            </ion-item>
            </ion-col>
        </ion-row>
    </ion-grid>

    @for (item of filteredTarefas; track item) {
        <ion-card>
            <ion-card-content>

            <ion-item lines="none">
                <ion-label>
                <h2 class="fw-bold">{{ item.tituloTarefa }}</h2>
                <p>Descrição: <strong>{{ item.descricao }}</strong></p>
                <p>Data prevista inicio: <strong>{{ item.dataPrevistaInicio }}</strong></p>
                <p>Data prevista termino: <strong>{{ item.dataPrevistaFim }}</strong></p>
                <p>Tipo de tarefa: <strong>{{ item.tipoTarefa?.nome }}</strong></p>
                <p>Estado da tarefa: <strong>{{ item.estadoTarefa }}</strong></p>
                <p>Programador atribuído: <strong>{{ item.programador?.nome }}</strong></p>
                <p>Data criação: <strong>{{ item.dataCriacao }}</strong></p>
                </ion-label>
            </ion-item>

            <div class="ion-text-end mt-2">
                <ion-button size="small" color="danger" (click)="setOpen(item)">
                eliminar
                </ion-button>
            </div>

            </ion-card-content>
        </ion-card>
    }

  <ion-modal (willDismiss)="onWillDismiss($event)">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Eliminar tarefa</ion-title>
          <ion-buttons slot="start">
            <ion-button (click)="cancel()">Fechar</ion-button>
          </ion-buttons>
          <ion-buttons slot="end">
            <ion-button color="danger" (click)="confirm()">Eliminar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        @if (tarefaDelete){
        <ion-list>
          <ion-item>
            <ion-input label="ID: " placeholder={{tarefaDelete.idTarefa}} disabled="true"></ion-input>
          </ion-item>
          <ion-item>
            <ion-input label="Titulo tarefa: " placeholder={{tarefaDelete.tituloTarefa}} disabled="true"></ion-input>
          </ion-item>
        </ion-list>
        }
      </ion-content>
    </ng-template>
  </ion-modal>
}